data:text/x-java;base64,cGFja2FnZSBpbXBsOwoKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwoKaW1wb3J0IGNvbW1vbi5BYnN0cmFjdEZhY3RvcnlDbGllbnQ7CmltcG9ydCBjb21tb24uTGFuZUNvZGVBbHJlYWR5SW5Vc2VFeGNlcHRpb247CmltcG9ydCBjb21tb24uTGFuZUNvZGVOb3RSZWdpc3RlcmVkRXhjZXB0aW9uOwppbXBvcnQgY29tbW9uLlByb2R1Y3RVbmF2YWlsYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IGludGVyZmFjZXMuSVZlbmRpbmdNYWNoaW5lUHJvZHVjdDsKaW1wb3J0IGludGVyZmFjZXMuSVZlbmRpbmdNYWNoaW5lOwppbXBvcnQgaW50ZXJmYWNlcy5JUHJvZHVjdFJlY29yZDsKCi8qKgogKiBUaGlzIGNsYXNzIHJlcHJlc2VudHMgYSBzaW1wbGUgdmVuZGluZyBtYWNoaW5lIHdoaWNoIGNhbiBzdG9jayBhbmQgc2VsbCBwcm9kdWN0cy4KICoKICovCnB1YmxpYyBjbGFzcyBWZW5kaW5nTWFjaGluZSBleHRlbmRzIEFic3RyYWN0RmFjdG9yeUNsaWVudCBpbXBsZW1lbnRzIElWZW5kaW5nTWFjaGluZSB7CgogICAgLy8gc3RvcmVzIGFsbCBvZiB0aGUgcHJvZHVjdHMgZm9yIGluIHRoZSB2ZW5kaW5nIG1hY2hpbmUgaW4gZm9ybSBLOiA8bGFuZT4sIFY6IDxwcm9kdWN0IGluc3RhbmNlPgogICAgcHJpdmF0ZSBIYXNoTWFwPFN0cmluZywgSVZlbmRpbmdNYWNoaW5lUHJvZHVjdD4gcHJvZHVjdHM7CiAgICAvLyB0aGlzIG1hcCBzdG9yZXMgSzogSVZlbmRpbmdNYWNoaW5lUHJvZHVjdCB0byBlbnN1cmUgdGhhdCB0aGUgcHJvZHVjdCByZWNvcmRzIGFyZSB0aWVkIHRvIHRoZSB2ZW5kaW5nCiAgICAvLyBtYWNoaW5lIGluc3RhbmNlLCBidXQgc3RpbGwgY291cGxlZCB0byB0aGVpciBjb3JyZXNwb25kaW5nIHByb2R1Y3QKICAgIHByaXZhdGUgSGFzaE1hcDxJVmVuZGluZ01hY2hpbmVQcm9kdWN0LCBJUHJvZHVjdFJlY29yZD4gcHJvZHVjdFJlY29yZHM7CgogICAgVmVuZGluZ01hY2hpbmUoKQogICAgewogICAgICAgIHByb2R1Y3RzID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBJVmVuZGluZ01hY2hpbmVQcm9kdWN0PigpOwogICAgICAgIHByb2R1Y3RSZWNvcmRzID0gbmV3IEhhc2hNYXA8SVZlbmRpbmdNYWNoaW5lUHJvZHVjdCwgSVByb2R1Y3RSZWNvcmQ+KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBhZGRzIGEgSVZlbmRpbmdNYWNoaW5lUHJvZHVjdCB0byB0aGUgcHJvZHVjdHMgSGFzaE1hcCwgYW5kCiAgICAgKiBjcmVhdGVzIGEgcHJvZHVjdCByZWNvcmQgZm9yIHRoZSBnaXZlbiBwcm9kdWN0LiBUaGlzIHByb2R1Y3QgcmVjb3JkIGlzCiAgICAgKiBhZGRlZCB0byB0aGUgcHJvZHVjdFJlY29yZHMgYXR0cmlidXRlIG9mIHRoZSBjbGFzcwogICAgICogQHBhcmFtIHZlbmRpbmdNYWNoaW5lUHJvZHVjdCByZXByZXNlbnRzIGFuIGluZGl2aWR1YWwgcHJvZHVjdCBzb2xkIGluIHRoZQogICAgICogdmVuZGluZyBtYWNoaW5lCiAgICAgKiBAdGhyb3dzIExhbmVDb2RlQWxyZWFkeUluVXNlRXhjZXB0aW9uIGlmIHRoZSBnaXZlbiBwcm9kdWN0IGhhcyBhIGxhbmUKICAgICAqIGNvZGUgd2hpY2ggaXMgYWxyZWFkeSBvY2N1cGllZAogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHJlZ2lzdGVyUHJvZHVjdChJVmVuZGluZ01hY2hpbmVQcm9kdWN0IHZlbmRpbmdNYWNoaW5lUHJvZHVjdCkKICAgICAgICB0aHJvd3MgTGFuZUNvZGVBbHJlYWR5SW5Vc2VFeGNlcHRpb24KICAgIHsKICAgICAgICAvLyBtYWtlcyBzdXJlIHRoZSBWZW5kaW5nTWFjaGluZVByb2R1Y3QgaW5zdGFuY2UgaXMgbm90IG51bGwKICAgICAgICBpZiAodmVuZGluZ01hY2hpbmVQcm9kdWN0ID09IG51bGwpCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKAogICAgICAgICAgICAgICAgInByb2R1Y3QgYmVpbmcgcmVnaXN0ZXJlZCB3aXRoIHRoZSB2ZW5kaW5nIG1hY2hpbmUgbXVzdCBub3QgYmUgbnVsbCIpOwogICAgICAgIH0KICAgICAgICAvLyBpZiB0aGUgbGFuZSBjb2RlIGFscmVhZHkgaGFzIGEgbWFwcGluZywgdGhyb3cgYW4gZXhjZXB0aW9uCiAgICAgICAgZWxzZSBpZiAocHJvZHVjdHMuZ2V0KHZlbmRpbmdNYWNoaW5lUHJvZHVjdC5nZXRMYW5lQ29kZSgpKSAhPSBudWxsKQogICAgICAgIHsKICAgICAgICAgICAgdGhyb3cgbmV3IExhbmVDb2RlQWxyZWFkeUluVXNlRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMucHJvZHVjdHMucHV0KAogICAgICAgICAgICB2ZW5kaW5nTWFjaGluZVByb2R1Y3QuZ2V0TGFuZUNvZGUoKSwgdmVuZGluZ01hY2hpbmVQcm9kdWN0KTsKICAgICAgICB0aGlzLnByb2R1Y3RSZWNvcmRzLnB1dCgKICAgICAgICAgICAgdmVuZGluZ01hY2hpbmVQcm9kdWN0LCBnZXRGYWN0b3J5KCkubWFrZVByb2R1Y3RSZWNvcmQodmVuZGluZ01hY2hpbmVQcm9kdWN0KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCB0YWtlcyBhIHByb2R1Y3QgYW5kIGl0J3MgcmVjb3JkIG91dCBvZiB0aGUgcHJvZHVjdHMgYW5kCiAgICAgKiBwcm9kdWN0UmVjb3JkcyBIYXNoTWFwcwogICAgICogQHBhcmFtIHZlbmRpbmdNYWNoaW5lUHJvZHVjdCB0aGUgcHJvZHVjdCB0byBiZSB1bnJlZ2lzdGVyZWQKICAgICAqIEB0aHJvd3MgTGFuZUNvZGVOb3RSZWdpc3RlcmVkRXhjZXB0aW9uIGlmIHRoZSBnaXZlbiBwcm9kdWN0IGlzCiAgICAgKiBub3QgcmVnaXN0ZXJlZCBpbiB0aGUgdmVuZGluZyBtYWNoaW5lCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgdW5yZWdpc3RlclByb2R1Y3QoSVZlbmRpbmdNYWNoaW5lUHJvZHVjdCB2ZW5kaW5nTWFjaGluZVByb2R1Y3QpCiAgICAgICAgdGhyb3dzIExhbmVDb2RlTm90UmVnaXN0ZXJlZEV4Y2VwdGlvbgogICAgewogICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIG1hcHBpbmcgZm9yIHRoZSBnaXZlbiBwcm9kdWN0LCB0aHJvdyBhbiBleGNlcHRpb24KICAgICAgICBpZiAocHJvZHVjdHMuZ2V0KHZlbmRpbmdNYWNoaW5lUHJvZHVjdC5nZXRMYW5lQ29kZSgpKSA9PSBudWxsKQogICAgICAgIHsKICAgICAgICAgICAgdGhyb3cgbmV3IExhbmVDb2RlTm90UmVnaXN0ZXJlZEV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICB0aGlzLnByb2R1Y3RzLnJlbW92ZSh2ZW5kaW5nTWFjaGluZVByb2R1Y3QuZ2V0TGFuZUNvZGUoKSk7CiAgICAgICAgdGhpcy5wcm9kdWN0UmVjb3Jkcy5yZW1vdmUodmVuZGluZ01hY2hpbmVQcm9kdWN0KTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGFkZHMgYW4gaXRlbSB0byB0aGUgYW1vdW50IGluIGEgZ2l2ZW4gbGFuZQogICAgICogQHBhcmFtIGxhbmVDb2RlIHRoZSBsYW5lIGNvZGUgZm9yIHRoZSBwcm9kdWN0IHRvIGhhdmUgYW4KICAgICAqIGl0ZW0gYWRkZWQgdG8gaXQKICAgICAqIEB0aHJvd3MgTGFuZUNvZGVOb3RSZWdpc3RlcmVkRXhjZXB0aW9uIGlmIHRoZXJlIGlzIG5vIHByb2R1Y3QKICAgICAqIHJlZ2lzdGVyZWQgaW4gdGhlIGdpdmVuIHBvc2l0aW9uCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgYWRkSXRlbShTdHJpbmcgbGFuZUNvZGUpIAogICAgICAgIHRocm93cyBMYW5lQ29kZU5vdFJlZ2lzdGVyZWRFeGNlcHRpb24KICAgIHsKICAgICAgICAvLyBtYWtlcyBzdXJlIHRoZXJlIGlzIGEgcHJvZHVjdCByZWdpc3RlcmVkIHdpdGggdGhpcyBsYW5lIGNvZGUKICAgICAgICBpZiAodGhpcy5wcm9kdWN0cy5nZXQobGFuZUNvZGUpID09IG51bGwpCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyBuZXcgTGFuZUNvZGVOb3RSZWdpc3RlcmVkRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIElWZW5kaW5nTWFjaGluZVByb2R1Y3QgcHJvZHVjdCA9IHRoaXMucHJvZHVjdHMuZ2V0KGxhbmVDb2RlKTsKICAgICAgICBJUHJvZHVjdFJlY29yZCBwcm9kdWN0UmVjb3JkID0gdGhpcy5wcm9kdWN0UmVjb3Jkcy5nZXQocHJvZHVjdCk7CiAgICAgICAgcHJvZHVjdFJlY29yZC5hZGRJdGVtKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpbWl0YXRlcyB0aGUgYmVoYXZpb3VyIG9mIGJ1eWluZyBhbiBpdGVtLCBhY2Nlc3NpbmcKICAgICAqIGl0IHZpYSBsYW5lIGNvZGUKICAgICAqIEBwYXJhbSBsYW5lQ29kZSBpcyB0aGUgcG9zaXRpb24gaW4gdGhlIHZlbmRpbmcgbWFjaGluZSBvZiB0aGUgcHJvZHVjdAogICAgICogYmVpbmcgYm91Z2h0CiAgICAgKiBAdGhyb3dzIExhbmVDb2RlTm90UmVnaXN0ZXJlZEV4Y2VwdGlvbiBpZiB0aGVyZSBpcyBubyBwcm9kdWN0CiAgICAgKiByZWdpc3RlcmVkIGluIHRoZSBnaXZlbiBwb3NpdGlvbgogICAgICogQHRocm93cyBQcm9kdWN0VW5hdmFpbGFibGVFeGNlcHRpb24gaWYgdGhlIHByb2R1Y3QgaGFzIG5vIGF2YWlsYWJsZQogICAgICogaXRlbXMKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBidXlJdGVtKFN0cmluZyBsYW5lQ29kZSkKICAgICAgICB0aHJvd3MgUHJvZHVjdFVuYXZhaWxhYmxlRXhjZXB0aW9uLCBMYW5lQ29kZU5vdFJlZ2lzdGVyZWRFeGNlcHRpb24KICAgIHsKICAgICAgICAvLyBtYWtlcyBzdXJlIHRoZXJlIGlzIGEgcHJvZHVjdCByZWdpc3RlcmVkIHdpdGggdGhpcyBsYW5lIGNvZGUKICAgICAgICBJVmVuZGluZ01hY2hpbmVQcm9kdWN0IHByb2R1Y3QgPSB0aGlzLnByb2R1Y3RzLmdldChsYW5lQ29kZSk7CiAgICAgICAgaWYgKHByb2R1Y3QgPT0gbnVsbCkKICAgICAgICB7CiAgICAgICAgICAgIHRocm93IG5ldyBMYW5lQ29kZU5vdFJlZ2lzdGVyZWRFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgSVByb2R1Y3RSZWNvcmQgcHJvZHVjdFJlY29yZCA9IHRoaXMucHJvZHVjdFJlY29yZHMuZ2V0KHByb2R1Y3QpOwogICAgICAgIHByb2R1Y3RSZWNvcmQuYnV5SXRlbSgpOwogICAgfQoKICAgIC8qKgogICAgICogdGhpcyBtZXRob2QgcmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIHByb2R1Y3RzLAogICAgICogYWNjZXNzZWQgdGhyb3VnaCB0aGUgSGFzaE1hcCB3aGljaCBzdG9yZXMgdGhlc2UKICAgICAqIHByb2R1Y3RzCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBwcm9kdWN0cyBpbiB2ZW5kaW5nIG1hY2hpbmUKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgaW50IGdldE51bWJlck9mUHJvZHVjdHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucHJvZHVjdHMuc2l6ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXRlcmF0ZXMgb3ZlciBhbGwgb2YgdGhlIHByb2R1Y3RzJyBwcm9kdWN0UmVjb3JkcwogICAgICogYW5kIGdldHMgdGhlIHRvdGFsIG51bWJlciBvZiBpdGVtcwogICAgICogQHJldHVybiB0aGUgdG90YWwgbnVtYmVyIG9mIGl0ZW1zIGluIHRoZSB2ZW5kaW5nIG1hY2hpbmUKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgaW50IGdldFRvdGFsTnVtYmVyT2ZJdGVtcygpIHsKICAgICAgICBpbnQgdG90YWxJdGVtcyA9IDA7CiAgICAgICAgZm9yIChJUHJvZHVjdFJlY29yZCByZWNvcmQ6IHRoaXMucHJvZHVjdFJlY29yZHMudmFsdWVzKCkpCiAgICAgICAgewogICAgICAgICAgICB0b3RhbEl0ZW1zICs9IHJlY29yZC5nZXROdW1iZXJBdmFpbGFibGUoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRvdGFsSXRlbXM7CiAgICB9CgogICAgLyoqCiAgICAgKiB0aGlzIG1ldGhvZCBnZXRzIHRoZSBudW1iZXIgb2YgYXZhaWxhYmxlIGl0ZW1zIGZvcgogICAgICogYSBnaXZlbiByZWdpc3RlcmVkIHByb2R1Y3QKICAgICAqIEByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVtcyBhdmFpbGFibGUgZm9yIGEgZ2l2ZW4KICAgICAqIHByb2R1Y3QKICAgICAqIEB0aHJvd3MgTGFuZUNvZGVOb3RSZWdpc3RlcmVkRXhjZXB0aW9uIGlmIHRoZXJlIGlzIG5vIHByb2R1Y3QKICAgICAqIHJlZ2lzdGVyZWQgaW4gdGhlIGdpdmVuIHBvc2l0aW9uCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIGludCBnZXROdW1iZXJPZkl0ZW1zKFN0cmluZyBsYW5lQ29kZSkKICAgICAgICB0aHJvd3MgTGFuZUNvZGVOb3RSZWdpc3RlcmVkRXhjZXB0aW9uCiAgICB7CiAgICAgICAgLy8gbWFrZXMgc3VyZSB0aGVyZSBpcyBhIHByb2R1Y3QgcmVnaXN0ZXJlZCB3aXRoIHRoaXMgbGFuZSBjb2RlCiAgICAgICAgSVZlbmRpbmdNYWNoaW5lUHJvZHVjdCBwcm9kdWN0ID0gdGhpcy5wcm9kdWN0cy5nZXQobGFuZUNvZGUpOwogICAgICAgIGlmIChwcm9kdWN0ID09IG51bGwpCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyBuZXcgTGFuZUNvZGVOb3RSZWdpc3RlcmVkRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIElQcm9kdWN0UmVjb3JkIHJlY29yZCA9IHRoaXMucHJvZHVjdFJlY29yZHMuZ2V0KHByb2R1Y3QpOwogICAgICAgIHJldHVybiByZWNvcmQuZ2V0TnVtYmVyQXZhaWxhYmxlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBnZXRzIHRoZSBudW1iZXIgb2Ygc2FsZXMgZm9yIGEgZ2l2ZW4gcmVnaXN0ZXJlZCBwcm9kdWN0CiAgICAgKiBnaXZlbiBpdCdzIGxhbmUgY29kZQogICAgICogQHBhcmFtIGxhbmVDb2RlIHRoZSBsYW5lIGNvZGUgb2YgYSByZWdpc3RlcmVkIHByb2R1Y3QKICAgICAqIEByZXR1cm4gdGhlIG51bWJlciBvZiBzb2xkIGl0ZW1zIG9mIHRoZSBwcm9kdWN0CiAgICAgKiBAdGhyb3dzIExhbmVDb2RlTm90UmVnaXN0ZXJlZEV4Y2VwdGlvbiBpZiB0aGVyZSBpcyBubyBwcm9kdWN0CiAgICAgKiByZWdpc3RlcmVkIGluIHRoZSBnaXZlbiBwb3NpdGlvbgogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBpbnQgZ2V0TnVtYmVyT2ZTYWxlcyhTdHJpbmcgbGFuZUNvZGUpCiAgICAgICAgdGhyb3dzIExhbmVDb2RlTm90UmVnaXN0ZXJlZEV4Y2VwdGlvbgogICAgewogICAgICAgIC8vIG1ha2VzIHN1cmUgbGFuZSBjb2RlIGlzIHJlZ2lzdGVyZWQKICAgICAgICBJVmVuZGluZ01hY2hpbmVQcm9kdWN0IHByb2R1Y3QgPSB0aGlzLnByb2R1Y3RzLmdldChsYW5lQ29kZSk7CiAgICAgICAgaWYgKHByb2R1Y3QgPT0gbnVsbCkKICAgICAgICB7CiAgICAgICAgICAgIHRocm93IG5ldyBMYW5lQ29kZU5vdFJlZ2lzdGVyZWRFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgSVByb2R1Y3RSZWNvcmQgcmVjb3JkID0gdGhpcy5wcm9kdWN0UmVjb3Jkcy5nZXQocHJvZHVjdCk7CiAgICAgICAgcmV0dXJuIHJlY29yZC5nZXROdW1iZXJPZlNhbGVzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpdGVyYXRlcyB0aHJvdWdoIGFsbCBvZiB0aGUgcHJvZHVjdHMgYW5kCiAgICAgKiByZXR1cm5zIHRoZSBtb3N0IHBvcHVsYXIKICAgICAqIEByZXR1cm4gdGhlIG1vc3QgcG9wdWxhciBwcm9kdWN0IGluIHRoZSB2ZW5kaW5nIG1hY2hpbmUKICAgICAqIEB0aHJvd3MgTGFuZUNvZGVOb3RSZWdpc3RlcmVkRXhjZXB0aW9uIGlmIHRoZXJlIGFyZSBubwogICAgICogcHJvZHVjdHMgcmVnaXN0ZXJlZAogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBJVmVuZGluZ01hY2hpbmVQcm9kdWN0IGdldE1vc3RQb3B1bGFyKCkKICAgICAgICB0aHJvd3MgTGFuZUNvZGVOb3RSZWdpc3RlcmVkRXhjZXB0aW9uCiAgICB7CiAgICAgICAgLy8gdGFrZXMgY2FyZSBvZiBjYXNlIHdoZXJlIG5vIHByb2R1Y3RzIGhhdmUgYmVlbiByZWdpc3RlcmVkCiAgICAgICAgaWYgKHRoaXMucHJvZHVjdHMuc2l6ZSgpID09IDApCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyBuZXcgTGFuZUNvZGVOb3RSZWdpc3RlcmVkRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIC8vIGl0ZXJhdGVzIHRocm91Z2ggdGhlIHByb2R1Y3QgcmVjb3JkcyB0byBmaW5kIHRoZSByZWNvcmQKICAgICAgICAvLyB3aXRoIHRoZSBtb3N0IHNhbGVzCiAgICAgICAgaW50IGN1cnJlbnRNYXggPSAwOwogICAgICAgIGludCBjdXJyZW50U2FsZXMgPSAwOwogICAgICAgIElWZW5kaW5nTWFjaGluZVByb2R1Y3QgbW9zdFBvcHVsYXIgPSBudWxsOwogICAgICAgIGZvciAoSVByb2R1Y3RSZWNvcmQgcmVjb3JkOiB0aGlzLnByb2R1Y3RSZWNvcmRzLnZhbHVlcygpKQogICAgICAgIHsKICAgICAgICAgICAgY3VycmVudFNhbGVzID0gcmVjb3JkLmdldE51bWJlck9mU2FsZXMoKTsKICAgICAgICAgICAgaWYgKGN1cnJlbnRTYWxlcyA+IGN1cnJlbnRNYXgpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRNYXggPSBjdXJyZW50U2FsZXM7CiAgICAgICAgICAgICAgICBtb3N0UG9wdWxhciA9IHJlY29yZC5nZXRQcm9kdWN0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudFNhbGVzID09IGN1cnJlbnRNYXgpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIGluIHRoZSBjYXNlIG9mIGEgdGllLCB0aGUgcHJvZHVjdCB3aG9zZSBkZXNjcmlwdGlvbgogICAgICAgICAgICAgICAgLy8gaXMgYWxwaGFiZXRpY2FsbHkgYmVmb3JlIHRoZSBvdGhlciBpcyBjaG9zZW4KICAgICAgICAgICAgICAgIFN0cmluZyBjdXJyZW50RGVzY3JpcHRpb24gPSByZWNvcmQuZ2V0UHJvZHVjdCgpLmdldERlc2NyaXB0aW9uKCk7CiAgICAgICAgICAgICAgICBTdHJpbmcgbW9zdFBvcHVsYXJEZXNjcmlwdGlvbiA9IG1vc3RQb3B1bGFyLmdldERlc2NyaXB0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudERlc2NyaXB0aW9uLmNvbXBhcmVUb0lnbm9yZUNhc2UobW9zdFBvcHVsYXJEZXNjcmlwdGlvbikgPCAwKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1vc3RQb3B1bGFyID0gcmVjb3JkLmdldFByb2R1Y3QoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbW9zdFBvcHVsYXI7CiAgICB9Cn0K